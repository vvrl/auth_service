

# Сервис аутентификации

## Запуск

1. Запустите приложение через Makefile или без него:

```
docker-compose -f docker-compose.yml up -d
```
```
make docker
make
```
`make docker` выставлен как дефолтное значение для запуска Makefile, поэтому `make` тоже сработает как `make docker`. Подключение к базе данных, миграции и запуск сервера настроены в приложении и выполняются автоматически при запуске приложения.

---

## Возможности

* Генерация пары токенов (Access + Refresh)
* Хешированное хранение refresh-токенов (bcrypt)
* Проверка User-Agent и IP при обновлении токенов
* Отзыв всех сессий при подозрительной активности
* Защищенные маршруты через middleware
* Отправка webhook при смене IP
* Поддержка logout и обновления токенов
* Swagger-документация с примерами

---

## Архитектура

* **Язык**: Go
* **Фреймворк**: Echo
* **JWT**: golang-jwt
* **Хеширование**: bcrypt
* **База данных**: PostgreSQL
* **Миграции**: goose
* **Логгирование**: logrus
* **Конфигурация**: .env + config

---

## Структура проекта

```
.
├── cmd/
│     └── main.go       # Точка входа
├── configs/            # Файлы конфигурации
├── internal/
│   ├── api/            # HTTP-хендлеры и middleware
│   ├── auth/           # Логика работы с токенами
│   ├── authservice/    # Запуск приложения
│   ├── config/         # Загрузка переменных
│   ├── logger/         # Создание логера
│   ├── migrations/     # goose миграции
│   └── storage/        # Работа с БД
├── 
├── .env                # Секреты и ключи
├── docker-compose.yml  # Настройка запуска всего сервиса (приложение + БД)
├── Dockerfile          # Настройка запуска приложения в контейнере
├── go.mod
├── go.sum              # Внешние зависимости
├── Makefile            # Makefile для удобного запуска
├── swagger.yaml        # Документация API
└── README.md           # Описание
```

---

## Документация API

Документация доступна в файле [swagger.yaml](./swagger.yaml) и может быть просмотрена через Swagger UI.

Каждая конечная точка содержит:

* Примеры запросов и ответов
* Описание возможных ошибок и кодов ответа

---

## Безопасность

* Refresh токены хранятся в виде хеша (bcrypt)
* Проверка User-Agent/IP при обновлении токена
* Logout с отменой всех сессий

---

##  Комментарий

Переменные окружения были намеренно распределены между `.env` и конфигурацией, чтобы продемонстрировать навыки работы с конфигами в реальных проектах.

---

## Контакты

Если у вас есть вопросы или предложения, пожалуйста, свяжитесь со мной по email или через Telegram @teema_0.

---